/**
 * story|ftw - v0.1.0 - 2015-02-28 | http://storyftw.com | Copyright (c) 2015; | Licensed GPLv2+
 */
window.StoryFTW=window.StoryFTW||{},window.StoryFTW.Utils=function(e,t,o,r){"use strict";function s(){var e={},t=function(t,o,s){"boolean"==typeof o&&(s=o);var i=o?o.selector+" "+t:t;return(r===e[i]||s)&&(e[i]=o?o.find(t):jQuery(t)),e[i]};return t}var i=e.StoryFTW_l10n,a={};return a.log=function(){a.log.logHistory=a.log.logHistory||[],a.log.logHistory.push(arguments),e.console&&i.debug&&e.console.log(Array.prototype.slice.call(arguments))},a.cache=new s,a}(window,document,jQuery),window.StoryFTW=window.StoryFTW||{},window.StoryFTW.app=function(e,t,o){"use strict";var r=e.StoryFTW_l10n,s=e.StoryFTW.Utils.log,i=e.StoryFTW.Utils.cache,a={is_touch:Modernizr.touch,flipsnap:new Flipsnap(".storybook",{transitionDuration:600}),queued:!1,videos:[],index:0,index_names:r.index_names,names_index:r.names_index},n={leftarrow:37,rightarrow:39,uparrow:38,downarrow:40,escape:27};return a.keydown=function(e){var t=e.keyCode;return t===n.leftarrow?(a.closeModals(),a.flipsnap.toPrev(),!1):t===n.rightarrow?(a.closeModals(),a.flipsnap.toNext(),!1):((t===n.uparrow||t===n.downarrow)&&(e.preventDefault(),a.closeModals(),t===n.uparrow?a.toggleMenu():a.hideMenu()),t===n.escape&&(e.preventDefault(),a.closeModals(),a.hideMenu()),undefined)},a.closeModals=function(){i(".js-modal").fadeOut().find(".js-embed-wrap").empty()},a.hideMenu=function(){i(".shifty").removeClass("show-menu")},a.showMenu=function(){i(".shifty").addClass("show-menu")},a.toggleMenu=function(){a.closeModals(),i(".shifty").hasClass("show-menu")?a.hideMenu():a.showMenu()},a.hex2rgb=function(e){return e?{r:parseInt(e.slice(-6,-4),16),g:parseInt(e.slice(-4,-2),16),b:parseInt(e.slice(-2),16)}:""},a.rgb2hsl=function(e,t){var o,r,s=e.r/255,i=e.g/255,a=e.b/255,n=Math.max(s,i,a),l=Math.min(s,i,a),c=(n+l)/2;if(n===l)o=r=0;else{var d=n-l;switch(r=c>.5?d/(2-n-l):d/(n+l),n){case s:o=(i-a)/d+(a>i?6:0);break;case i:o=(a-s)/d+2;break;case a:o=(s-i)/d+4}o/=6}var u={h:o,s:r,l:c};return t?u.l:u},o.fn.bgrgb=function(e,t){if(!e)return this;var r=e.r+", "+e.g+", "+e.b;return t&&(r+=", "+t),o(this).css({"background-color":"rgba( "+r+" )"})},o.fn.showOrHide=function(t){var s=a.storyPageData[t],n=o(this);a.storyPageData[t]=s?s:r.story[t];var l=a.storyPageData[t]&&!("footertitleshow"===t&&769>i(e).width());return l?(n.removeClass("super-hide"),a.showFooter=!0):n.addClass("super-hide"),this},a.createVideos=function(){a.$storyPages.each(function(){var e,t=o(this),r=t.data("storymeta"),s=r&&r.mp4;s&&(e=o("<video></video>").attr("muted",!0)),a.videos.push(e)})},a.unloadVideos=function(){a.$storyPages.each(function(e){(a.index-2>e||e>a.index+2)&&o(a.$storyPages[e]).find("video").detach()})},a.loadVideo=function(e){var t=o(a.$storyPages[e]),r=a.videos[e],s=t.find(".bg-video-wrap")[0],i=o(r).html("");if(s){var n=a.storyPageData.mp4,l=a.storyPageData.webm,c=a.storyPageData.ogv,d="";n&&(d+='<source src="'+n+'">'),l&&(d+='<source src="'+l+'">'),c&&(d+='<source src="'+c+'">'),i.append(d),r.load(),i.appendTo(s)}},a.playVideo=function(){a.video&&a.video.pause(),a.queued&&(a.video=a.queued),a.video&&(a.video.play(),o(a.video).bind("timeupdate",function(){a.video.currentTime>a.video.duration-.3&&(a.video.currentTime=0,a.video.play())}))},a.triggerVideo=function(){a.is_touch||(e.clearTimeout(a.vidTimeout),a.unloadVideos(),a.loadVideo(a.index),a.loadVideo(a.index+1),a.loadVideo(a.index-1),a.queued=a.$storyPage.find("video")[0],a.vidTimeout=e.setTimeout(function(){a.playVideo()},20))},a.updateNav=function(){(i(".js-story-page-previous").is(":visible")||i(".js-story-page-next").is(":visible"))&&(a.flipsnap.hasNext()?i(".js-story-page-next").is(":visible")||i(".js-story-page-next").removeClass("hide"):i(".js-story-page-next").addClass("hide"),a.flipsnap.hasPrev()?i(".js-story-page-previous").is(":visible")?o(".js-coach-mark").is(":visible")&&o(".js-coach-mark").removeClass("table-cell").addClass("hide"):(i(".js-story-page-previous").removeClass("hide"),o(".js-coach-mark").removeClass("table-cell").addClass("hide")):(i(".js-story-page-previous").addClass("hide"),o(".js-coach-mark").removeClass("hide").addClass("table-cell")))},a.updateColors=function(){var e=a.storyPageData.color;if(e){var t=a.hex2rgb(e);i(".bg-dynamic").css({"background-color":e}),i(".bg-dynamic-a").bgrgb(t,".75"),a.lightOrDark("light"!==a.storyPageData.textcolor)}},a.lightOrDark=function(e){e?o(".story-page .light").removeClass("light").addClass("dark"):o(".story-page .dark").removeClass("dark").addClass("light")},a.editLink=function(e){if(i("#wp-admin-bar-storyftw-edit-page").length){var t=i("> .ab-item",i("#wp-admin-bar-storyftw-edit-page")),o=i("span",t).data("href");t.attr("href",o.replace("idreplace",e))}},a.footerOverrides=function(){var e=i(".sftw-navbar");a.showFooter=!1,i(".footer-text-color.center",e).showOrHide("footertitleshow"),i(".js-shifty-toggle.btn",e).showOrHide("tocshow"),i(".facebook-share-button",e).showOrHide("fbshow"),i(".twitter-share-button",e).showOrHide("twshow"),a.showFooter?e.removeClass("super-hide"):e.addClass("super-hide")},a.colorOverrides=function(){a.storyPageData.footertextcolor?o(".footer-text-color, .footer-text-color a").css({color:a.storyPageData.footertextcolor}):r.story.footertextcolor&&o(".footer-text-color, .footer-text-color a").css({color:""}),a.storyPageData.linkcolor?o(".story-page a:not( .btn )").css({color:a.storyPageData.linkcolor}):r.story.linkcolor&&o(".story-page a:not( .btn )").css({color:""}),a.storyPageData.arrowcolor?o(".arrow-color").css({color:a.storyPageData.arrowcolor}):r.story.arrowcolor&&o(".arrow-color").css({color:""}),a.storyPageData.footerbuttontextcolor?o(".footer-button-text-color").css({color:a.storyPageData.footerbuttontextcolor}):r.story.footerbuttontextcolor&&o(".footer-button-text-color").css({color:""})},a.storyPageChange=function(t){if(i(".shifty").removeClass("show-menu"),a.$storyPages.removeClass("active"),!1!==a.initPage(t.newPoint)){if("story-page-redirect"===a.storyPage.id)return e.location.href=a.$storyPage.data("redirect"),undefined;e.location.hash=a.index_names[a.index],a.triggerVideo(),a.updateColors(),a.updateNav(),a.editLink(a.storyPageData.id),a.footerOverrides(),a.colorOverrides()}},a.initPage=function(e){return a.index=e,a.storyPage=a.$storyPages[a.index],a.storyPage?(a.$storyPage=o(a.storyPage).addClass("active"),a.video=a.$storyPage.find("video")[0],a.storyPageData=a.$storyPage.data("storymeta"),undefined):!1},a.init=function(){if(s(r),a.$storyPages=i(".story-page"),FastClick.attach(t.body),a.flipsnap.element.addEventListener("fspointmove",a.storyPageChange,!1),a.flipsnap.hasPrev()||i(".js-story-page-previous").addClass("hide"),e.location.hash){i(".storybook").css({transition:"none"}),e.setTimeout(function(){i(".storybook").css({transition:""})},500);var n=e.location.hash.split("#")[1];a.index=a.names_index[n],a.index=isNaN(a.index)?0:a.index,a.flipsnap.moveToPoint(a.index)}else a.flipsnap.moveToPoint(0);o(t).on("keydown",a.keydown),a.is_touch||(a.createVideos(),!1!==a.initPage(0)&&a.triggerVideo()),i("body").on("click",".js-story-page-btn",function(e){e.preventDefault(),a.index=o(o(this).attr("href")).index(".story-page"),a.flipsnap.moveToPoint(a.index)}).on("click",".js-story-page-next",function(){a.closeModals(),a.flipsnap.toNext()}).on("click",".js-story-page-previous",function(){a.closeModals(),a.flipsnap.toPrev()}).on("click",".js-shifty-toggle",function(){a.toggleMenu()}).on("click",".js-show-modal",function(){var e=o(this),t=e.data("vidid");if(t){var r=i("#"+t).show(),s=i(".js-embed-wrap",r),a=r.data("src");a?s.html(o("<iframe>",{src:a,frameborder:0})).fitVids():s.html(i(".tmpl-videoModal",r).html()).fitVids()}}).on("click",".js-hide-modal",function(){a.closeModals()})},o(t).ready(a.init),a}(window,document,jQuery);